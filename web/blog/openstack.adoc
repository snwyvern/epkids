:linkattrs:
:source-highlighter: rouge

== Openstack



=== Create controller,network,compute1

```bash
lxc launch images:ubuntu/yakkety/amd64 os-controller
lxc network create mgmt-net ipv6.address=none ipv4.address=10.0.3.1/24 ipv4.nat=true
lxc network attach mgmt-net os-controller  eth0
lxc config device set os-controller eth0 ipv4.address 10.0.3.11
#install some essentials on the controller: zsh,vim,ssh ..
lxc snapshot  os-controller base

lxc copy os-controller/base  os-network
lxc config device set os-network eth0 ipv4.address 10.0.3.22

lxc copy os-controller/base  os-compute1
lxc config device set os-compute1 eth0 ipv4.address 10.0.3.33
```

=== os-controller

==== openstackclient

```bash
apt install python-openstackclient
```
==== mariadb

```bash
apt install mariadb-server python-pymysql
```
./etc/mysql/mariadb.conf.d/99-openstack.cnf
```
[mysqld]
bind-address = 10.0.3.11

default-storage-engine = innodb
innodb_file_per_table = on
max_connections = 4096
collation-server = utf8_general_ci
character-set-server = utf8
```

```bash
service mysql restart
```

==== rabbitmq

```bash
apt install rabbitmq-server
rabbitmqctl add_user openstack RABBIT_PASS #ms123
rabbitmqctl set_permissions openstack ".*" ".*" ".*"
```

==== memcache

```bash
apt install memcached python-memcache
```

./etc/memcached.conf  #default
```
-l 127.0.0.1
```

```bash
service memcached restart
```


==== keystone

```bash
mysql
```

.KEYSTONE_DBPASS=ms123
```sql
CREATE DATABASE keystone;
GRANT ALL PRIVILEGES ON keystone.* TO 'keystone'@'localhost' IDENTIFIED BY 'KEYSTONE_DBPASS';
GRANT ALL PRIVILEGES ON keystone.* TO 'keystone'@'%' IDENTIFIED BY 'KEYSTONE_DBPASS';
```

```bash
apt install keystone
```

./etc/keystone/keystone.conf
```
[database]
# ...
connection = mysql+pymysql://keystone:KEYSTONE_DBPASS@controller/keystone

[token]
# ...
provider = fernet
```

.Befüllen Sie die Identitätsdienst-Datenbank:
```bash
su -s /bin/sh -c "keystone-manage db_sync" keystone
```

.Initialisieren der Fernet key repositories:

```bash
keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone
keystone-manage credential_setup --keystone-user keystone --keystone-group keystone
```


.Bootstrap des Identitätsdienstes, ADMIN_PASS=ms123
```bash
keystone-manage bootstrap --bootstrap-password ADMIN_PASS \
  --bootstrap-admin-url http://os-controller:35357/v3/ \
  --bootstrap-internal-url http://os-controller:5000/v3/ \
  --bootstrap-public-url http://os-controller:5000/v3/ \
  --bootstrap-region-id RegionOne
```
